<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{CLIENT_NAME}} 7-Act Consolidated Assessment — Interactive Report</title>
<!--
  ╔══════════════════════════════════════════════════════════════════════╗
  ║  ASSESSMENT DASHBOARD TEMPLATE — Source of Truth                    ║
  ║                                                                    ║
  ║  This is the COMPLETE parameterized template for the premium       ║
  ║  interactive HTML dashboard generated by /generate-assessment-html ║
  ║                                                                    ║
  ║  IMPORTANT: This file contains the AUTHORITATIVE CSS and JS.       ║
  ║  The /generate-assessment-html skill reads this file via the       ║
  ║  Read tool and clones it as the HTML starting point. The skill     ║
  ║  then replaces {{PLACEHOLDER}} markers with engagement data.       ║
  ║                                                                    ║
  ║  DO NOT modify the CSS or JS in the skill file — change HERE       ║
  ║  first, then the skill references this file automatically.         ║
  ║                                                                    ║
  ║  DESIGN RULE: Light base theme (#F8FAFC). Body is NEVER dark.     ║
  ║  Dark colors only for: sidebar, dark-feature sections,             ║
  ║  metric-cards, journey-swimlanes, waterfall containers.            ║
  ║                                                                    ║
  ║  PLACEHOLDERS:                                                     ║
  ║  {{CLIENT_NAME}}      — Client short name (e.g., "NFIS")          ║
  ║  {{REPORT_SUBTITLE}}  — e.g., "7-Act Consolidated Report"         ║
  ║  {{ASSESSMENT_DATE}}  — e.g., "February 2026"                     ║
  ║  {{HERO_H1}}          — Multi-line hero heading (use <br>/<span>) ║
  ║  {{HERO_SUBTITLE}}    — 1-2 sentence hero subtitle                ║
  ║  {{HERO_TAGS}}        — <span class="hero-tag">Tag</span> items   ║
  ║  {{HERO_ALERT}}       — Cost of inaction alert HTML               ║
  ║  {{HERO_IMAGE_URL}}   — Unsplash URL for hero image               ║
  ║  {{HERO_FLOATS}}      — Floating glass card divs                  ║
  ║  {{HERO_STATS}}       — hero-stat divs (5 stats)                  ║
  ║  PANEL PLACEHOLDERS (V5 — sub-structured per panel):              ║
  ║  Exec: EXEC_SUMMARY_DESC, EXEC_TRANSFORMATION_STORY,             ║
  ║        EXEC_BENTO_ITEMS, EXEC_PILLARS, EXEC_METRIC_CARDS,        ║
  ║        EXEC_DECISION_BOX                                          ║
  ║  Acts 1-3: ACTn_TITLE, ACTn_DESC, ACTn_TRANSFORMATION_THREAD,    ║
  ║            ACT1_DARK_FEATURE, ACT1_INSIGHT_CARDS,                 ║
  ║            ACT2_PILLAR_CARDS, ACT3_LIGHTHOUSE_DETAIL,             ║
  ║            ACT3_MILESTONE_CARDS, ACTn_ADDITIONAL_CONTENT          ║
  ║  Act 4: ACT4_PERSONAS, ACT4_JX_HEADLINES, ACT4_JX_SVG,           ║
  ║         ACT4_JX_PANELS                                            ║
  ║  Act 5: ACT5_PROBLEM_MAP, ACT5_HEATMAP_DATA (JS), ACT5_PRIORITY  ║
  ║  Act 6: ACT6_TIMELINE, ACT6_PHASE_CARDS                          ║
  ║  Act 7: ACT7_ROI_CARDS, ACT7_BASE_DESC, ACT7_SCENARIO_DATA (JS), ║
  ║         ACT7_FINANCIAL_TABLE, ACT7_VALUE_LEVERS                   ║
  ║  Journey: JOURNEY_DESC, JOURNEY_SWIMLANES                        ║
  ║  Use Cases: USECASES_TITLE, USECASES_DESC, USECASES_CARDS,       ║
  ║             USECASES_PHONE_PROTOTYPES                             ║
  ╚══════════════════════════════════════════════════════════════════════╝
-->
<link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* ══════════════════════════ CSS CUSTOM PROPERTIES ══════════════════════════ */
:root {
  --bg: #F8FAFC; --card: #FFFFFF; --border: #E2E8F0; --text: #091C35; --muted: #64748B; --dim: #94A3B8;
  --L0: #DC2626; --L1: #EA580C; --L2: #0891B2; --L3: #059669; --L4: #2563EB;
  --accent: #3366FF; --accent-light: #E5EBFF;
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
  --shadow: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
  --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.07), 0 2px 4px -2px rgba(0,0,0,0.05);
  --shadow-lg: 0 10px 25px -3px rgba(0,0,0,0.08), 0 4px 6px -4px rgba(0,0,0,0.04);
  --radius: 12px; --radius-lg: 16px;
  --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ══════════════════════════ RESET & BASE ══════════════════════════ */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }
body { font-family: 'Libre Franklin', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; font-size: 15px; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; text-rendering: optimizeLegibility; }
.wrap { max-width: 1360px; margin: 0 auto; padding: 0 48px 100px; margin-left: 260px; }
h2 { font-size: 1.8rem; font-weight: 800; letter-spacing: -0.5px; margin-bottom: 8px; }
h3 { font-size: 1.2rem; font-weight: 700; margin-bottom: 8px; letter-spacing: -0.2px; }
h4 { font-size: 0.95rem; font-weight: 700; margin-bottom: 4px; }

/* ══════════════════════════ LEFT SIDEBAR NAV ══════════════════════════ */
.sidebar { position: fixed; top: 0; left: 0; width: 250px; height: 100vh; background: #091C35; z-index: 200; display: flex; flex-direction: column; overflow-y: auto; box-shadow: 4px 0 24px rgba(0,0,0,0.12); }
.sidebar-brand { padding: 28px 24px 20px; border-bottom: 1px solid rgba(255,255,255,0.08); background: linear-gradient(180deg, rgba(51,102,255,0.08) 0%, transparent 100%); }
.sidebar-brand-logo { font-size: 0.65rem; font-weight: 800; text-transform: uppercase; letter-spacing: 2.5px; color: rgba(255,255,255,0.55); margin-bottom: 6px; }
.sidebar-brand-title { font-size: 1.1rem; font-weight: 800; color: #FFFFFF; letter-spacing: -0.3px; line-height: 1.3; }
.sidebar-brand-sub { font-size: 0.7rem; color: rgba(255,255,255,0.55); margin-top: 4px; }
.sidebar-nav { flex: 1; padding: 16px 0; }
.tab-btn { display: flex; align-items: center; gap: 12px; width: 100%; padding: 12px 24px; font-size: 0.82rem; font-weight: 600; color: rgba(255,255,255,0.55); cursor: pointer; border: none; background: none; white-space: nowrap; transition: all 0.25s ease; font-family: inherit; text-align: left; position: relative; border-left: 3px solid transparent; }
.tab-btn:hover { color: rgba(255,255,255,0.9); background: rgba(255,255,255,0.04); border-left-color: rgba(51,102,255,0.3); }
.tab-btn.active { color: #FFFFFF; background: rgba(51,102,255,0.12); border-left-color: #3366FF; }
.tab-btn .tab-num { display: inline-flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.4); font-size: 0.6rem; font-weight: 800; width: 22px; height: 22px; border-radius: 6px; flex-shrink: 0; transition: all 0.25s ease; }
.tab-btn:hover .tab-num { background: rgba(51,102,255,0.2); color: rgba(255,255,255,0.7); }
.tab-btn.active .tab-num { background: #3366FF; color: #fff; box-shadow: 0 0 12px rgba(51,102,255,0.4); }
.tab-btn .tab-label { line-height: 1.3; }
.tab-btn.active::after { content: ''; position: absolute; right: 0; top: 50%; transform: translateY(-50%); width: 3px; height: 20px; background: #3366FF; border-radius: 3px 0 0 3px; box-shadow: 0 0 8px rgba(51,102,255,0.5); }
.sidebar-footer { padding: 16px 24px; border-top: 1px solid rgba(255,255,255,0.06); }
.sidebar-footer-text { font-size: 0.62rem; color: rgba(255,255,255,0.2); line-height: 1.4; }
.sidebar-divider { height: 1px; background: rgba(255,255,255,0.06); margin: 8px 20px; }

/* ══════════════════════════ PANELS ══════════════════════════ */
.panel { display: none; opacity: 0; transform: translateY(16px); transition: opacity 0.5s ease, transform 0.5s ease; padding-top: 48px; }
.panel.active { display: block; opacity: 1; transform: translateY(0); }
.section-header { margin-bottom: 48px; padding-bottom: 28px; border-bottom: 1px solid var(--border); position: relative; }
.section-header::after { content: ''; position: absolute; bottom: -1px; left: 0; width: 100px; height: 3px; background: linear-gradient(90deg, #3366FF, #7B2FFF); border-radius: 2px; }
.section-header h2 { font-size: 2.2rem; font-weight: 900; letter-spacing: -1px; line-height: 1.1; }
.section-header .overline { font-size: 0.62rem; font-weight: 700; text-transform: uppercase; letter-spacing: 3px; color: var(--accent); margin-bottom: 10px; background: linear-gradient(90deg, #3366FF, #7B2FFF); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.section-header p { max-width: 640px; font-size: 0.9rem; color: var(--muted); line-height: 1.7; }

/* ══════════════════════════ HERO — FUTURE UI STYLE ══════════════════════════ */
.hero { margin-left: 250px; position: relative; overflow: hidden; }
.hero-dark { background: #FAFAF8; padding: 0; position: relative; overflow: hidden; min-height: 90vh; display: flex; flex-direction: column; }
.hero-dark::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 1px; background: var(--border); z-index: 2; }
.hero-dark-inner { max-width: 1360px; margin: 0 auto; padding: 80px 48px 0; display: grid; grid-template-columns: 1fr 520px; gap: 32px; align-items: start; flex: 1; position: relative; z-index: 3; }
.hero-overline { font-size: 0.58rem; font-weight: 700; text-transform: uppercase; letter-spacing: 3px; color: var(--muted); margin-bottom: 28px; }
.hero-content h1 { font-size: 5.5rem; font-weight: 900; letter-spacing: -4px; line-height: 0.92; margin-bottom: 0; color: #091C35; }
.hero-content h1 span { display: block; letter-spacing: -3px; color: #091C35; }
.hero-sub { color: var(--muted); font-size: 0.92rem; margin: 28px 0 32px; line-height: 1.7; max-width: 420px; }
.hero-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 36px; }
.hero-tag { display: inline-block; padding: 8px 18px; border-radius: 24px; font-size: 0.68rem; font-weight: 600; border: 1px solid #D1D5DB; color: #6B7280; background: transparent; transition: all 0.25s ease; letter-spacing: 0.3px; }
.hero-tag:hover { border-color: #3366FF; color: #3366FF; }
.hero-alert { padding: 18px 22px; background: #FEF2F2; border: 1px solid #FECACA; border-radius: 16px; font-size: 0.84rem; color: #6B7280; line-height: 1.7; }
.hero-alert strong { color: #DC2626; }
.hero-visual { position: relative; overflow: hidden; border-radius: 24px 24px 0 0; height: 100%; min-height: 520px; }
.hero-visual-img { width: 100%; height: 100%; object-fit: cover; object-position: center 20%; display: block; border-radius: 24px 24px 0 0; }
.hero-float { position: absolute; z-index: 3; background: rgba(255,255,255,0.85); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.6); border-radius: 14px; padding: 12px 18px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
.hero-float:hover { transform: translateY(-4px) scale(1.03); box-shadow: 0 8px 32px rgba(0,0,0,0.12); }
.hero-float-val { font-size: 1.2rem; font-weight: 800; color: #091C35; line-height: 1.2; }
.hero-float-lbl { font-size: 0.56rem; color: #6B7280; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-top: 3px; }
.hero-stats-strip { background: #FFFFFF; border-bottom: 1px solid var(--border); padding: 0; }
.hero-stats-inner { max-width: 1360px; margin: 0 auto; padding: 0 48px; display: grid; grid-template-columns: repeat(5, 1fr); }
.hero-stat { text-align: center; padding: 32px 16px; position: relative; transition: background 0.2s ease; }
.hero-stat:hover { background: #F8FAFC; }
.hero-stat:not(:last-child)::after { content: ''; position: absolute; right: 0; top: 20%; height: 60%; width: 1px; background: var(--border); }
.hero-stat-val { font-size: 2rem; font-weight: 900; line-height: 1.1; transition: transform 0.3s ease; letter-spacing: -1px; }
.hero-stat:hover .hero-stat-val { transform: scale(1.08); }
.hero-stat-lbl { font-size: 0.58rem; color: var(--muted); text-transform: uppercase; letter-spacing: 1.5px; margin-top: 6px; font-weight: 600; }

/* ══════════════════════════ BENTO GRID SYSTEM ══════════════════════════ */
.bento { display: grid; grid-template-columns: repeat(4, 1fr); grid-auto-rows: 180px; gap: 16px; margin-bottom: 48px; }
.bento-item { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 28px; overflow: hidden; position: relative; transition: all 0.35s cubic-bezier(0.4,0,0.2,1); }
.bento-item:hover { box-shadow: var(--shadow-lg); transform: translateY(-3px); }
.bento-2x1 { grid-column: span 2; } .bento-1x2 { grid-row: span 2; }
.bento-2x2 { grid-column: span 2; grid-row: span 2; }
.bento-stat { display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
.bento-stat-val { font-size: 3rem; font-weight: 900; letter-spacing: -2px; line-height: 1; }
.bento-stat-lbl { font-size: 0.68rem; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; margin-top: 8px; font-weight: 600; }
.bento-dark { background: #091C35; border-color: #1E293B; color: #FFFFFF; }
.bento-dark .bento-stat-lbl { color: rgba(255,255,255,0.55); }
.bento-accent { background: linear-gradient(135deg, #3366FF, #3B82F6); border: none; color: #FFFFFF; }
.bento-accent .bento-stat-lbl { color: rgba(255,255,255,0.6); }

/* ══════════════════════════ DARK FEATURE SECTION ══════════════════════════ */
.dark-feature { background: #091C35; border-radius: 28px; padding: 72px 56px; margin: 56px 0; position: relative; overflow: hidden; }
.dark-feature::before { content: ''; position: absolute; top: -120px; right: -80px; width: 400px; height: 400px; background: radial-gradient(circle, rgba(51,102,255,0.12) 0%, transparent 70%); pointer-events: none; }
.dark-feature::after { content: ''; position: absolute; bottom: -100px; left: -60px; width: 300px; height: 300px; background: radial-gradient(circle, rgba(123,47,255,0.08) 0%, transparent 70%); pointer-events: none; }
.dark-feature-overline { font-size: 0.6rem; font-weight: 700; text-transform: uppercase; letter-spacing: 3px; color: #3366FF; margin-bottom: 16px; }
.dark-feature h3 { font-size: 2.8rem; font-weight: 900; letter-spacing: -2px; line-height: 1.05; color: #FFFFFF; margin-bottom: 12px; }
.dark-feature h3 span { background: linear-gradient(135deg, #3366FF, #7B61FF); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.dark-feature-sub { color: rgba(255,255,255,0.55); font-size: 0.9rem; max-width: 520px; line-height: 1.7; margin-bottom: 48px; }
.dark-feature-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
.dark-feature-card { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.06); border-radius: 20px; padding: 32px 28px; transition: all 0.35s ease; position: relative; overflow: hidden; }
.dark-feature-card:hover { background: rgba(255,255,255,0.07); border-color: rgba(51,102,255,0.25); transform: translateY(-4px); box-shadow: 0 12px 40px rgba(0,0,0,0.3); }
.dark-feature-card h4 { font-size: 1rem; font-weight: 700; color: #FFFFFF; margin-bottom: 8px; letter-spacing: -0.3px; }
.dark-feature-card p { font-size: 0.78rem; color: rgba(255,255,255,0.55); line-height: 1.6; }

/* ══════════════════════════ CARDS ══════════════════════════ */
.card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 28px; box-shadow: var(--shadow-sm); transition: all 0.35s cubic-bezier(0.4,0,0.2,1); position: relative; overflow: hidden; }
.card:hover { box-shadow: 0 8px 30px rgba(0,0,0,0.08); transform: translateY(-3px); }
.card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #3366FF, #7B2FFF, #3366FF); transform: scaleX(0); transform-origin: left; transition: transform 0.4s ease; opacity: 0.7; }
.card:hover::before { transform: scaleX(1); }
.card-grid { display: grid; gap: 16px; }
.card-grid-2 { grid-template-columns: repeat(2, 1fr); }
.card-grid-3 { grid-template-columns: repeat(3, 1fr); }
.card-grid-4 { grid-template-columns: repeat(4, 1fr); }

/* ══════════════════════════ METRIC CARDS (DARK) ══════════════════════════ */
.metric-card { background: #091C35; border: 1px solid #1E293B; border-radius: 20px; padding: 28px 20px; text-align: center; transition: all 0.35s ease; position: relative; overflow: hidden; }
.metric-card:hover { transform: translateY(-3px); box-shadow: 0 8px 24px rgba(51,102,255,0.08); border-color: rgba(51,102,255,0.15); }
.metric-val { font-size: 2rem; font-weight: 900; line-height: 1; margin-bottom: 6px; letter-spacing: -1px; color: #FFFFFF; transition: transform 0.3s ease; }
.metric-card:hover .metric-val { transform: scale(1.05); }
.metric-lbl { font-size: 0.65rem; color: rgba(255,255,255,0.55); line-height: 1.4; text-transform: uppercase; letter-spacing: 0.8px; font-weight: 600; }

/* ══════════════════════════ PERSONA CARDS ══════════════════════════ */
.persona-card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; overflow: hidden; cursor: pointer; transition: all 0.35s ease; }
.persona-card:hover { box-shadow: 0 12px 32px rgba(0,0,0,0.08); transform: translateY(-4px); }
.persona-header { padding: 24px 28px; display: flex; align-items: center; gap: 18px; transition: background 0.3s ease; }
.persona-card:hover .persona-header { background: rgba(51,102,255,0.02); }
.persona-avatar { width: 56px; height: 56px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; font-weight: 800; color: #fff; flex-shrink: 0; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: box-shadow 0.3s ease, transform 0.3s ease; }
.persona-card:hover .persona-avatar { box-shadow: 0 6px 20px rgba(0,0,0,0.25); transform: scale(1.08); }
.persona-name { font-weight: 800; font-size: 1rem; letter-spacing: -0.2px; }
.persona-role { font-size: 0.75rem; color: var(--muted); font-weight: 600; }
.persona-body { padding: 0 28px 24px; display: none; }
.persona-card.open .persona-body { display: block; }
.expand-hint { font-size: 0.68rem; color: var(--accent); font-weight: 700; padding: 0 28px 14px; text-transform: uppercase; letter-spacing: 0.5px; }
.persona-card.open .expand-hint { display: none; }

/* ══════════════════════════ EXPANDABLE SECTIONS ══════════════════════════ */
.expandable { border: 1px solid var(--border); border-radius: 16px; overflow: hidden; margin-bottom: 12px; background: var(--card); transition: all 0.35s ease; }
.expandable:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.05); border-color: rgba(51,102,255,0.15); }
.expand-header { padding: 18px 24px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; transition: all 0.25s ease; font-weight: 700; font-size: 0.9rem; }
.expand-header:hover { background: #F8FAFC; }
.expand-arrow { transition: transform 0.3s; font-size: 0.8rem; color: var(--muted); }
.expandable.open .expand-arrow { transform: rotate(180deg); }
.expandable.open { border-color: rgba(51,102,255,0.2); box-shadow: 0 4px 16px rgba(51,102,255,0.06); }
.expand-body { max-height: 0; overflow: hidden; transition: max-height 0.4s ease, padding 0.3s ease; }
.expandable.open .expand-body { max-height: 2000px; }
.expand-content { padding: 0 24px 24px; }
.expand-content p, .expand-content li { font-size: 0.85rem; color: var(--muted); line-height: 1.7; }

/* ══════════════════════════ SCORE BADGES ══════════════════════════ */
.score-badge { display: inline-flex; align-items: center; justify-content: center; width: 32px; height: 32px; border-radius: 8px; font-weight: 800; font-size: 0.85rem; color: #fff; transition: transform 0.2s ease, box-shadow 0.2s ease; }
.score-badge:hover { transform: scale(1.15); }
.score-badge.s0 { background: var(--L0); } .score-badge.s1 { background: var(--L1); }
.score-badge.s2 { background: var(--L2); } .score-badge.s3 { background: var(--L3); }
.score-badge.s4 { background: var(--L4); }
.score-bar { height: 8px; border-radius: 4px; background: var(--border); overflow: hidden; }
.score-bar-fill { height: 100%; border-radius: 4px; transition: width 0.8s ease; }

/* ══════════════════════════ HEATMAP GRID (CAPABILITY MAP) ══════════════════════════ */
.heatmap-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
.hm-cell { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 16px 12px; text-align: center; cursor: pointer; transition: all 0.3s ease; }
.hm-cell:hover { transform: translateY(-4px); box-shadow: 0 12px 28px rgba(0,0,0,0.08); }
.hm-cell.selected { outline: 2px solid var(--accent); outline-offset: -1px; box-shadow: 0 0 0 4px rgba(51,102,255,0.1); }
.hm-cell .hm-score { width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px; font-weight: 900; font-size: 0.95rem; color: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.15); transition: transform 0.3s ease; }
.hm-cell:hover .hm-score { transform: scale(1.15); }
.hm-cell .hm-id { font-size: 0.62rem; color: var(--muted); font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
.hm-cell .hm-name { font-size: 0.72rem; font-weight: 700; color: var(--text); margin-top: 4px; line-height: 1.3; }
.hm-detail-panel { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 28px; margin-top: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.08); display: none; }
.hm-detail-panel.visible { display: block; }

/* ══════════════════════════ DISTRIBUTION BAR ══════════════════════════ */
.dist-bar { display: flex; height: 32px; border-radius: 8px; overflow: hidden; margin: 12px 0; }
.dist-seg { display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: 700; color: #fff; min-width: 40px; }
.dist-legend { display: flex; gap: 16px; flex-wrap: wrap; margin-top: 8px; }
.dist-legend-item { display: flex; align-items: center; gap: 6px; font-size: 0.78rem; color: var(--muted); }
.dist-legend-dot { width: 10px; height: 10px; border-radius: 3px; }

/* ══════════════════════════ LIFECYCLE PIPELINE ══════════════════════════ */
.lc-stage { position:relative; cursor:pointer; padding:16px 12px 14px; text-align:center; background:var(--card); border:2px solid var(--border); transition:all 0.35s cubic-bezier(0.4,0,0.2,1); user-select:none; overflow:hidden; }
.lc-stage:first-child { border-radius:16px 0 0 16px; }
.lc-stage:last-child { border-radius:0 16px 16px 0; }
.lc-stage:not(:first-child) { border-left:none; }
.lc-stage::before { content:''; position:absolute; top:0; left:0; right:0; height:4px; background:var(--stage-color); opacity:0.3; transition:opacity 0.35s ease, height 0.35s ease; }
.lc-stage:hover::before { opacity:0.6; }
.lc-stage:hover { transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,0,0,0.06); z-index:2; }
.lc-stage.active { border-color:var(--stage-color); background:var(--card); box-shadow:0 8px 32px rgba(0,0,0,0.08); z-index:3; transform:translateY(-3px); }
.lc-stage.active::before { opacity:1; height:5px; }
.lc-stage .lc-num { display:inline-flex; align-items:center; justify-content:center; width:28px; height:28px; border-radius:50%; font-size:0.7rem; font-weight:800; background:rgba(0,0,0,0.04); color:var(--muted); margin-bottom:8px; transition:all 0.35s ease; }
.lc-stage.active .lc-num { background:var(--stage-color); color:#fff; box-shadow:0 2px 10px rgba(0,0,0,0.15); }
.lc-stage .lc-icon { font-size:1.4rem; margin-bottom:4px; display:block; filter:grayscale(0.4); transition:filter 0.35s ease; }
.lc-stage.active .lc-icon { filter:grayscale(0); }
.lc-stage .lc-title { font-size:0.82rem; font-weight:800; color:var(--text); letter-spacing:-0.3px; margin-bottom:3px; transition:color 0.35s ease; }
.lc-stage.active .lc-title { color:var(--stage-color); }
.lc-stage .lc-sub { font-size:0.62rem; color:var(--muted); line-height:1.4; margin-bottom:6px; }
.lc-stage .lc-stat { display:inline-block; padding:4px 12px; border-radius:8px; font-size:0.68rem; font-weight:700; background:rgba(0,0,0,0.03); color:var(--muted); transition:all 0.35s ease; }
.lc-stage.active .lc-stat { background:var(--stage-color); color:#fff; }
.lc-stage:not(:last-child)::after { content:''; position:absolute; right:-11px; top:50%; transform:translateY(-50%); width:0; height:0; border-top:10px solid transparent; border-bottom:10px solid transparent; border-left:10px solid var(--border); z-index:4; transition:border-left-color 0.35s ease; }
.lc-stage.active:not(:last-child)::after { border-left-color:var(--stage-color); }
.lc-detail-section { animation:lcSlideIn 0.45s cubic-bezier(0.4,0,0.2,1); }
@keyframes lcSlideIn { from { opacity:0; transform:translateY(16px); } to { opacity:1; transform:translateY(0); } }
.lc-l1-card { background:var(--card); border:2px solid var(--border); border-radius:16px; padding:24px; cursor:pointer; transition:all 0.3s ease; position:relative; overflow:hidden; }
.lc-l1-card::before { content:''; position:absolute; top:0; left:0; right:0; height:3px; background:var(--stage-color); opacity:0; transition:opacity 0.3s ease; }
.lc-l1-card:hover { border-color:var(--stage-color); box-shadow:0 8px 24px rgba(0,0,0,0.06); transform:translateY(-2px); }
.lc-l1-card:hover::before { opacity:0.5; }
.lc-l1-card.expanded { border-color:var(--stage-color); }
.lc-l1-card.expanded::before { opacity:1; }
.lc-l2-zone { overflow:hidden; max-height:0; opacity:0; transition:max-height 0.5s cubic-bezier(0.4,0,0.2,1), opacity 0.4s ease, margin 0.4s ease; margin-top:0; }
.lc-l2-zone.open { max-height:3000px; opacity:1; margin-top:16px; }
.lc-cap-card { background:var(--card); border:2px solid var(--border); border-radius:14px; padding:18px; transition:all 0.3s ease; position:relative; overflow:hidden; }
.lc-cap-card:hover { border-color:var(--cap-color, var(--border)); box-shadow:0 8px 24px rgba(0,0,0,0.06); transform:translateY(-2px); }

/* ══════════════════════════ TIMELINE (ROADMAP) ══════════════════════════ */
.timeline { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; position: relative; }
.timeline::before { content: ''; position: absolute; top: 40px; left: 5%; right: 5%; height: 3px; background: linear-gradient(90deg, var(--L1), var(--L2), var(--L3), var(--L4)); border-radius: 2px; z-index: 0; }
.timeline-phase { position: relative; z-index: 1; }
.phase-dot { width: 28px; height: 28px; border-radius: 50%; border: 3px solid; margin: 0 auto 16px; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: box-shadow 0.3s ease, transform 0.3s ease; }
.timeline-phase:hover .phase-dot { transform: scale(1.3); }
.phase-card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 24px; box-shadow: var(--shadow-sm); cursor: pointer; transition: all 0.35s ease; overflow: hidden; position: relative; }
.phase-card:hover { box-shadow: 0 8px 24px rgba(0,0,0,0.08); transform: translateY(-3px); }
.phase-card h4 { font-size: 0.92rem; margin-bottom: 4px; font-weight: 800; letter-spacing: -0.2px; }
.phase-card .phase-time { font-size: 0.72rem; color: var(--muted); font-weight: 600; }
.phase-card .phase-cost { font-size: 0.88rem; font-weight: 800; color: var(--accent); margin-top: 8px; }
.phase-items { display: none; margin-top: 14px; padding-top: 14px; border-top: 1px solid var(--border); }
.phase-card.open .phase-items { display: block; }
.phase-items li { font-size: 0.8rem; color: var(--muted); margin-bottom: 6px; padding-left: 16px; position: relative; line-height: 1.5; }
.phase-items li::before { content: ''; position: absolute; left: 0; top: 8px; width: 6px; height: 6px; border-radius: 50%; background: var(--accent); }

/* ══════════════════════════ PHONE FRAME PROTOTYPES ══════════════════════════ */
.proto-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 40px; }
.phone-frame { width: 280px; height: 580px; margin: 0 auto; background: #0D1117; border-radius: 36px; padding: 12px; box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.05); position: relative; overflow: hidden; }
.phone-frame::before { content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 120px; height: 28px; background: #0D1117; border-radius: 0 0 16px 16px; z-index: 10; }
.phone-screen { width: 100%; height: 100%; background: #FFFFFF; border-radius: 26px; overflow: hidden; position: relative; }

/* ══════════════════════════ JOURNEY RAIL ══════════════════════════ */
.journey-hero { background: linear-gradient(160deg, #091C35 0%, #111827 50%, #091C35 100%); border-radius: 28px; padding: 72px 56px; margin-bottom: 56px; position: relative; overflow: hidden; }
.journey-hero::before { content: ''; position: absolute; top: -50%; right: -20%; width: 600px; height: 600px; background: radial-gradient(circle, rgba(51,102,255,0.15) 0%, transparent 60%); pointer-events: none; }
.journey-rail { position: relative; padding-left: 56px; }
.journey-rail::before { content: ''; position: absolute; left: 16px; top: 8px; bottom: 8px; width: 1px; background: linear-gradient(to bottom, var(--border) 0%, rgba(51,102,255,0.2) 30%, rgba(5,150,105,0.2) 60%, var(--border) 100%); }
.journey-stage { position: relative; margin-bottom: 0; padding-bottom: 32px; }
.journey-stage:last-child { padding-bottom: 0; }
.journey-node { position: absolute; left: -56px; top: 4px; width: 33px; text-align: center; font-size: 0.6rem; font-weight: 800; letter-spacing: 0.5px; color: var(--muted); z-index: 2; line-height: 1; }
.journey-node-num { display: block; font-size: 1.1rem; font-weight: 900; letter-spacing: -1px; margin-bottom: 2px; }
.journey-node-dot { display: block; width: 5px; height: 5px; border-radius: 50%; margin: 0 auto; }
.journey-card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; overflow: hidden; transition: all 0.35s ease; }
.journey-card:hover { box-shadow: var(--shadow-lg); transform: translateY(-3px); }

/* ══════════════════════════ BACKBASE LAYER TAGS ══════════════════════════ */
.bb-layer { display: inline-flex; align-items: center; gap: 6px; padding: 6px 14px; border-radius: 8px; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin: 0 6px 6px 0; }
.bb-layer-engagement { background: rgba(51,102,255,0.08); color: #3366FF; border: 1px solid rgba(51,102,255,0.15); }
.bb-layer-orchestration { background: rgba(5,150,105,0.08); color: #059669; border: 1px solid rgba(5,150,105,0.15); }
.bb-layer-intelligence { background: rgba(123,47,255,0.08); color: #7B2FFF; border: 1px solid rgba(123,47,255,0.15); }
.bb-layer-ai { background: rgba(234,88,12,0.08); color: #EA580C; border: 1px solid rgba(234,88,12,0.15); }
.bb-layer-integration { background: rgba(100,116,139,0.08); color: #64748B; border: 1px solid rgba(100,116,139,0.15); }

/* ══════════════════════════ USE CASE CARDS ══════════════════════════ */
.uc-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
.uc-card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-lg); overflow: hidden; cursor: pointer; transition: all 0.3s cubic-bezier(0.4,0,0.2,1); position: relative; }
.uc-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #3366FF, #3B82F6); opacity: 0; transition: opacity 0.3s ease; }
.uc-card:hover { box-shadow: var(--shadow-lg); transform: translateY(-3px); }
.uc-card:hover::before { opacity: 1; }

/* ══════════════════════════ ROI DASHBOARD ══════════════════════════ */
.roi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-top: 20px; }
.roi-card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; text-align: center; transition: all 0.3s ease; }
.roi-card:hover { transform: translateY(-3px); box-shadow: 0 8px 24px rgba(51,102,255,0.08); }
.roi-card-val { font-size: 1.8rem; font-weight: 800; color: var(--accent); transition: transform 0.3s ease; }
.roi-card:hover .roi-card-val { transform: scale(1.06); }
.roi-card-lbl { font-size: 0.75rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px; }

/* ══════════════════════════ VALUE LEVER CARDS (EXPANDABLE) ══════════════════════════ */
.lever-card { border: 1px solid var(--border); border-radius: 16px; margin-bottom: 12px; overflow: hidden; background: var(--card); transition: all 0.35s ease; }
.lever-card:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.05); border-color: rgba(51,102,255,0.15); }
.lever-header { padding: 18px 24px; display: flex; align-items: center; gap: 12px; cursor: pointer; transition: background 0.2s ease; }
.lever-header:hover { background: #F8FAFC; }
.lever-num { font-size: 0.7rem; font-weight: 800; color: var(--accent); min-width: 28px; }
.lever-name { font-weight: 700; font-size: 0.9rem; flex: 1; }
.lever-value { font-weight: 800; font-size: 0.95rem; min-width: 80px; text-align: right; }
.lever-arrow { color: var(--muted); font-size: 0.8rem; transition: transform 0.3s ease; }
.lever-card.open .lever-arrow { transform: rotate(180deg); }
.lever-card.open { border-color: rgba(51,102,255,0.2); box-shadow: 0 4px 16px rgba(51,102,255,0.06); }
.lever-body { max-height: 0; overflow: hidden; transition: max-height 0.4s ease; }
.lever-card.open .lever-body { max-height: 800px; }
.lever-content { padding: 0 24px 24px; }
.lever-mece { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px; }
.lever-mece-box { padding: 14px; border-radius: 12px; font-size: 0.8rem; line-height: 1.7; color: var(--muted); }
.lever-mece-box h5 { font-size: 0.68rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 6px; }
.lever-benchmark { background: #F0F4FF; border-radius: 10px; padding: 12px 16px; font-size: 0.8rem; margin-bottom: 12px; }
.lever-benchmark strong { font-weight: 700; color: var(--accent); }
.lever-capabilities { display: flex; flex-wrap: wrap; gap: 6px; }
.lever-cap-tag { padding: 4px 10px; border-radius: 6px; font-size: 0.62rem; font-weight: 700; background: rgba(51,102,255,0.06); color: var(--accent); border: 1px solid rgba(51,102,255,0.12); text-transform: uppercase; letter-spacing: 0.5px; }

/* ══════════════════════════ PROGRESS BARS (Problem Map) ══════════════════════════ */
.progress-row { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
.progress-label { min-width: 180px; font-size: 0.8rem; font-weight: 600; }
.progress-track { flex: 1; height: 10px; background: var(--border); border-radius: 5px; overflow: hidden; }
.progress-fill { height: 100%; border-radius: 5px; transition: width 1s ease; }
.progress-value { min-width: 60px; font-size: 0.8rem; font-weight: 700; color: var(--accent); text-align: right; }

/* ══════════════════════════ SCENARIO TOGGLE ══════════════════════════ */
.scenario-toggle { display: inline-flex; background: #F1F5F9; border-radius: 10px; padding: 4px; gap: 4px; margin-bottom: 24px; }
.scenario-btn { padding: 8px 20px; border-radius: 8px; border: none; font-size: 0.82rem; font-weight: 700; cursor: pointer; background: none; color: var(--muted); transition: var(--transition); font-family: inherit; }
.scenario-btn.active { background: #fff; color: var(--accent); box-shadow: var(--shadow-sm); }

/* ══════════════════════════ CONFIDENCE BADGES ══════════════════════════ */
.conf-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 14px; border-radius: 8px; font-size: 0.8rem; font-weight: 700; }
.conf-high { background: #D1FAE5; color: #059669; }
.conf-medium { background: linear-gradient(135deg, #FEF3C7, #FDE68A); color: #B45309; }
.conf-low { background: #FEF2F2; color: #DC2626; }

/* ══════════════════════════ JOURNEY SWIMLANE ══════════════════════════ */
.journey-swimlane { background: #091C35; border-radius: 20px; padding: 32px; margin: 24px 0; overflow-x: auto; }
.journey-swimlane-title { font-size: 1.1rem; font-weight: 800; color: #FFFFFF; margin-bottom: 4px; letter-spacing: -0.3px; }
.journey-swimlane-sub { font-size: 0.75rem; color: rgba(255,255,255,0.55); margin-bottom: 24px; }
.swimlane-grid { display: grid; gap: 1px; background: rgba(255,255,255,0.06); border-radius: 12px; overflow: hidden; }
.swimlane-header { background: rgba(255,255,255,0.08); padding: 10px 14px; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; color: rgba(255,255,255,0.55); text-align: center; }
.swimlane-actor { background: rgba(51,102,255,0.1); padding: 12px 14px; font-size: 0.72rem; font-weight: 700; color: #60A5FA; display: flex; align-items: center; }
.swimlane-cell { background: rgba(255,255,255,0.03); padding: 12px 14px; font-size: 0.78rem; color: rgba(255,255,255,0.75); line-height: 1.5; min-height: 60px; transition: background 0.2s ease; }
.swimlane-cell:hover { background: rgba(255,255,255,0.06); }
.swimlane-cell.friction-critical { border-top: 3px solid #DC2626; }
.swimlane-cell.friction-high { border-top: 3px solid #EA580C; }
.swimlane-cell.friction-moderate { border-top: 3px solid #F59E0B; }
.swimlane-cell.friction-minor { border-top: 3px solid #34D399; }
.swimlane-time { font-size: 0.65rem; color: rgba(255,255,255,0.4); margin-top: 4px; }
.swimlane-systems { font-size: 0.6rem; color: rgba(255,255,255,0.3); font-style: italic; margin-top: 2px; }
.swimlane-value-lost { font-size: 0.72rem; font-weight: 800; color: #DC2626; margin-top: 6px; }
.swimlane-toggle-group { display: inline-flex; background: rgba(255,255,255,0.06); border-radius: 10px; padding: 4px; gap: 4px; margin-bottom: 20px; }
.swimlane-toggle-btn { padding: 8px 20px; border-radius: 8px; border: none; font-size: 0.78rem; font-weight: 700; cursor: pointer; background: none; color: rgba(255,255,255,0.5); transition: all 0.25s ease; font-family: inherit; }
.swimlane-toggle-btn.active-current { background: rgba(220,38,38,0.15); color: #DC2626; }
.swimlane-toggle-btn.active-future { background: rgba(52,211,153,0.15); color: #34D399; }
.swimlane-panel { display: none; }
.swimlane-panel.active { display: block; }

/* ══════════════════════════ FRICTION CALLOUT CARDS ══════════════════════════ */
.friction-callout { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 28px; margin-bottom: 16px; position: relative; overflow: hidden; transition: all 0.35s ease; }
.friction-callout:hover { box-shadow: 0 8px 30px rgba(0,0,0,0.08); transform: translateY(-3px); }
.friction-callout.severity-critical::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #DC2626, #EF4444); }
.friction-callout.severity-high::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #EA580C, #FB923C); }
.friction-callout.severity-moderate::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #F59E0B, #FBBF24); }
.friction-callout-rank { font-size: 0.6rem; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; color: var(--muted); margin-bottom: 6px; }
.friction-callout-title { font-size: 1.05rem; font-weight: 800; color: var(--text); margin-bottom: 8px; letter-spacing: -0.3px; }
.friction-callout-impact { font-size: 1.8rem; font-weight: 900; color: #DC2626; line-height: 1.1; margin-bottom: 12px; letter-spacing: -1px; }
.friction-callout-quote { font-size: 0.85rem; font-style: italic; color: var(--muted); line-height: 1.7; padding: 12px 16px; border-left: 3px solid var(--border); margin-bottom: 14px; background: #F8FAFC; border-radius: 0 8px 8px 0; }
.friction-callout-fix { font-size: 0.82rem; color: #059669; font-weight: 600; line-height: 1.6; }
.friction-callout-fix strong { color: #047857; }
.friction-callout-meta { display: flex; gap: 12px; margin-top: 12px; flex-wrap: wrap; }
.friction-callout-tag { display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 6px; font-size: 0.62rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; background: rgba(51,102,255,0.06); color: var(--accent); border: 1px solid rgba(51,102,255,0.12); }

/* ══════════════════════════ VALUE LEAKAGE WATERFALL ══════════════════════════ */
.waterfall-container { background: #091C35; border-radius: 20px; padding: 32px; margin: 24px 0; }
.waterfall-title { font-size: 1.1rem; font-weight: 800; color: #FFFFFF; margin-bottom: 4px; letter-spacing: -0.3px; }
.waterfall-sub { font-size: 0.75rem; color: rgba(255,255,255,0.55); margin-bottom: 24px; }
.waterfall-bar-row { display: flex; align-items: center; gap: 14px; margin-bottom: 12px; }
.waterfall-label { min-width: 140px; font-size: 0.75rem; font-weight: 600; color: rgba(255,255,255,0.7); text-align: right; }
.waterfall-bar-track { flex: 1; height: 28px; background: rgba(255,255,255,0.04); border-radius: 6px; overflow: hidden; display: flex; position: relative; }
.waterfall-bar-remaining { background: linear-gradient(90deg, #3366FF, #3B82F6); height: 100%; transition: width 0.8s ease; border-radius: 6px 0 0 6px; }
.waterfall-bar-leaked { background: linear-gradient(90deg, #DC2626, #EF4444); height: 100%; transition: width 0.8s ease; }
.waterfall-value { min-width: 90px; font-size: 0.72rem; font-weight: 700; color: #DC2626; }
.waterfall-cumulative { font-size: 0.82rem; font-weight: 800; color: #DC2626; margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.08); text-align: right; }
.waterfall-cumulative span { color: rgba(255,255,255,0.55); font-weight: 600; }

/* ══════════════════════════ JOURNEY EXPERIENCE MAP ══════════════════════════ */
.jx { position: relative; }

/* Headline Insights */
.jx-headlines { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; margin-bottom: 32px; }
.jx-hl { display: flex; align-items: flex-start; gap: 14px; padding: 18px 20px; background: var(--card); border: 1px solid var(--border); border-radius: 16px; position: relative; overflow: hidden; }
.jx-hl::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; }
.jx-hl.red::before { background: linear-gradient(90deg, #DC2626, #EF4444); }
.jx-hl.amber::before { background: linear-gradient(90deg, #EA580C, #F97316); }
.jx-hl.blue::before { background: linear-gradient(90deg, #2563EB, #60A5FA); }
.jx-hl-icon { width: 42px; height: 42px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0; }
.jx-hl-stat { font-size: 0.85rem; font-weight: 900; letter-spacing: -0.3px; margin-bottom: 2px; }
.jx-hl-text { font-size: 0.76rem; color: var(--muted); line-height: 1.5; }

/* SVG Map Container */
.jx-map { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 20px 12px 8px; margin-bottom: 24px; overflow: hidden; }
.jx-map svg { width: 100%; height: auto; display: block; }
.jx-map svg text { font-family: inherit; }
.jx-marker { cursor: pointer; }
.jx-marker .dot { transition: all 0.3s ease; }
.jx-marker .halo { opacity: 0; transition: opacity 0.3s ease; }
.jx-marker:hover .halo { opacity: 0.08; }
.jx-marker:hover .dot { filter: brightness(1.1); }
.jx-marker.active .halo { opacity: 0.12; }
.jx-marker .stage-label { transition: all 0.3s ease; }
.jx-marker.active .stage-label { fill: var(--accent) !important; font-weight: 900 !important; }

/* Detail Panel */
.jx-panel { display: none; animation: jxSlide 0.35s ease; }
.jx-panel.active { display: block; }
@keyframes jxSlide { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

/* Panel Header */
.jx-panel-head { display: flex; align-items: center; gap: 18px; padding: 24px 28px; background: var(--card); border: 1px solid var(--border); border-radius: 20px; margin-bottom: 16px; position: relative; overflow: hidden; }
.jx-panel-head::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; }
.jx-panel-num { width: 52px; height: 52px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 1.2rem; color: #fff; flex-shrink: 0; }
.jx-panel-meta h3 { font-size: 1.2rem; font-weight: 900; letter-spacing: -0.3px; margin-bottom: 2px; }
.jx-panel-meta .sub { font-size: 0.82rem; color: var(--muted); }
.jx-panel-score { margin-left: auto; text-align: center; }
.jx-panel-score .sv { font-size: 2.2rem; font-weight: 900; line-height: 1; }
.jx-panel-score .sl { font-size: 0.65rem; color: var(--muted); font-weight: 600; margin-top: 3px; }

/* Narrative */
.jx-narrative { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 22px 26px; margin-bottom: 16px; font-size: 0.92rem; color: var(--text); line-height: 1.85; }
.jx-narrative strong { font-weight: 800; }

/* Pain Point Cards */
.jx-pains { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 14px; margin-bottom: 16px; }
.jx-pain { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; position: relative; overflow: hidden; transition: all 0.3s ease; }
.jx-pain:hover { box-shadow: 0 6px 20px rgba(0,0,0,0.06); transform: translateY(-2px); }
.jx-pain::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; }
.jx-pain.critical::before { background: linear-gradient(90deg, #DC2626, #EF4444); }
.jx-pain.high::before { background: linear-gradient(90deg, #EA580C, #F97316); }
.jx-pain.medium::before { background: linear-gradient(90deg, #D97706, #FBBF24); }
.jx-pain.uf::before { background: linear-gradient(90deg, #2563EB, #60A5FA); }
.jx-pain.pending { border-style: dashed; border-color: #DDD6FE; }
.jx-pain.pending::before { background: linear-gradient(90deg, #7C3AED, #C084FC); }
.jx-sev { display: inline-block; padding: 3px 10px; border-radius: 8px; font-size: 0.58rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; }
.jx-sev.critical { background: #FEF2F2; color: #DC2626; }
.jx-sev.high { background: #FFF7ED; color: #EA580C; }
.jx-sev.medium { background: #FFFBEB; color: #D97706; }
.jx-sev.uf { background: #EFF6FF; color: #2563EB; }
.jx-sev.pending { background: #F5F3FF; color: #7C3AED; }
.jx-pain h5 { font-size: 0.92rem; font-weight: 800; letter-spacing: -0.2px; margin-bottom: 6px; }
.jx-pain p { font-size: 0.8rem; color: var(--muted); line-height: 1.6; }
.jx-impact { margin-top: 12px; display: inline-block; padding: 6px 14px; border-radius: 10px; font-size: 0.72rem; font-weight: 700; }
.jx-pain.critical .jx-impact { background: #FEF2F2; color: #DC2626; }
.jx-pain.high .jx-impact { background: #FFF7ED; color: #EA580C; }
.jx-pain.uf .jx-impact { background: #EFF6FF; color: #1D4ED8; }

/* Evidence Quote */
.jx-quote { background: linear-gradient(135deg, #FFFBEB, #FEF3C7); border-radius: 16px; padding: 22px 26px; position: relative; }
.jx-quote::before { content: '\201C'; position: absolute; top: 6px; left: 14px; font-size: 2.8rem; color: rgba(217,119,6,0.1); font-family: Georgia, serif; line-height: 1; }
.jx-quote p { font-size: 0.88rem; color: #78350F; font-style: italic; line-height: 1.75; padding-left: 22px; }
.jx-quote .src { font-size: 0.7rem; color: #92400E; font-style: normal; font-weight: 700; margin-top: 8px; padding-left: 22px; }

@media (max-width: 900px) {
  .jx-headlines { grid-template-columns: 1fr; }
  .jx-map { overflow-x: auto; -webkit-overflow-scrolling: touch; }
  .jx-map svg { min-width: 800px; }
  .jx-pains { grid-template-columns: 1fr; }
  .jx-panel-head { flex-direction: column; text-align: center; }
}

/* ══════════════════════════ SCROLL REVEAL ══════════════════════════ */
.reveal { opacity: 0; transform: translateY(40px); transition: opacity 0.8s cubic-bezier(0.16,1,0.3,1), transform 0.8s cubic-bezier(0.16,1,0.3,1); }
.reveal.visible { opacity: 1; transform: translateY(0); }

/* ══════════════════════════ TRACEABILITY ══════════════════════════ */
[data-trace-id] { cursor: pointer; transition: outline 0.2s ease, box-shadow 0.2s ease; }
.trace-highlight { outline: 2px solid #3366FF !important; outline-offset: 2px; box-shadow: 0 0 12px rgba(51,102,255,0.2) !important; }

/* ══════════════════════════ CUSTOM SCROLLBAR ══════════════════════════ */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(51,102,255,0.15); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: rgba(51,102,255,0.3); }
.sidebar::-webkit-scrollbar { width: 4px; }
.sidebar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 2px; }
::selection { background: rgba(51,102,255,0.12); color: inherit; }

/* ══════════════════════════ ANIMATIONS ══════════════════════════ */
@keyframes fadeSlideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes floatParticle { 0%,100% { transform: translateY(0) translateX(0); } 25% { transform: translateY(-20px) translateX(10px); } 50% { transform: translateY(-10px) translateX(-5px); } 75% { transform: translateY(-30px) translateX(15px); } }
.bg-particle { position: fixed; border-radius: 50%; pointer-events: none; z-index: 0; opacity: 0.04; animation: floatParticle 20s ease-in-out infinite; }

/* ══════════════════════════ PRINT SUPPORT ══════════════════════════ */
@media print {
  .sidebar { display: none; }
  .hero { margin-left: 0; }
  .wrap { margin-left: 0; }
  .panel { display: block !important; opacity: 1 !important; transform: none !important; page-break-inside: avoid; }
  .expand-body { max-height: none !important; }
  body { font-size: 11px; }
}

/* ══════════════════════════ RESPONSIVE ══════════════════════════ */
@media (max-width: 1100px) {
  .sidebar { width: 200px; }
  .wrap { margin-left: 210px; }
  .hero { margin-left: 200px; }
  .hero-dark-inner { grid-template-columns: 1fr 360px; gap: 24px; padding: 60px 32px 0; }
  .hero-content h1 { font-size: 3.8rem; letter-spacing: -3px; }
  .bento { grid-template-columns: repeat(3, 1fr); }
}
@media (max-width: 900px) {
  .sidebar { width: 60px; overflow: hidden; }
  .sidebar-brand-title, .sidebar-brand-sub, .sidebar-brand-logo, .tab-btn .tab-label, .sidebar-footer, .sidebar-divider { display: none; }
  .tab-btn { padding: 14px 0; justify-content: center; gap: 0; border-left: none; }
  .tab-btn .tab-num { width: 32px; height: 32px; font-size: 0.7rem; border-radius: 8px; }
  .wrap { margin-left: 70px; }
  .hero { margin-left: 60px; }
  .hero-dark-inner { grid-template-columns: 1fr; padding: 40px 24px 0; }
  .hero-content h1 { font-size: 3rem; }
  .bento { grid-template-columns: repeat(2, 1fr); }
  .card-grid-3, .card-grid-4 { grid-template-columns: 1fr 1fr; }
  .timeline { grid-template-columns: repeat(2, 1fr); }
  .roi-grid { grid-template-columns: repeat(2, 1fr); }
  .uc-grid { grid-template-columns: 1fr; }
  .proto-grid { grid-template-columns: 1fr; }
  .dark-feature-grid { grid-template-columns: 1fr 1fr; }
  .dark-feature { padding: 48px 32px; }
}
@media (max-width: 600px) {
  .sidebar { display: none; }
  .wrap { margin-left: 0; padding: 0 16px 60px; }
  .hero { margin-left: 0; }
  .hero-content h1 { font-size: 1.8rem; letter-spacing: -1px; }
  .hero-float { display: none; }
  .card-grid-2, .card-grid-3, .card-grid-4 { grid-template-columns: 1fr; }
  .bento { grid-template-columns: 1fr; grid-auto-rows: auto; }
  .timeline { grid-template-columns: 1fr; }
  .roi-grid { grid-template-columns: 1fr 1fr; }
  .dark-feature-grid { grid-template-columns: 1fr; }
  .dark-feature { padding: 36px 24px; margin: 32px 0; border-radius: 20px; }
  .lever-mece { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<!-- ═══════ SIDEBAR ═══════ -->
<nav class="sidebar">
  <div class="sidebar-brand">
    <div class="sidebar-brand-logo">Backbase</div>
    <div class="sidebar-brand-title">{{CLIENT_NAME}} Assessment</div>
    <div class="sidebar-brand-sub">{{REPORT_SUBTITLE}}</div>
  </div>
  <div class="sidebar-nav">
    <button class="tab-btn active" data-tab="exec" onclick="switchTab('exec')">
      <span class="tab-num" style="background:rgba(255,255,255,0.15);">&#9670;</span>
      <span class="tab-label">Executive Summary</span>
    </button>
    <div class="sidebar-divider"></div>
    <button class="tab-btn" data-tab="act1" onclick="switchTab('act1')"><span class="tab-num">1</span><span class="tab-label">Strategic Alignment</span></button>
    <button class="tab-btn" data-tab="act2" onclick="switchTab('act2')"><span class="tab-num">2</span><span class="tab-label">The Vision</span></button>
    <button class="tab-btn" data-tab="act3" onclick="switchTab('act3')"><span class="tab-num">3</span><span class="tab-label">The Lighthouse</span></button>
    <button class="tab-btn" data-tab="act4" onclick="switchTab('act4')"><span class="tab-num">4</span><span class="tab-label">Deep-Dive</span></button>
    <button class="tab-btn" data-tab="act5" onclick="switchTab('act5')"><span class="tab-num">5</span><span class="tab-label">Capability Map</span></button>
    <button class="tab-btn" data-tab="act6" onclick="switchTab('act6')"><span class="tab-num">6</span><span class="tab-label">Roadmap</span></button>
    <button class="tab-btn" data-tab="act7" onclick="switchTab('act7')"><span class="tab-num">7</span><span class="tab-label">Benefits Case</span></button>
    <div class="sidebar-divider"></div>
    <button class="tab-btn" data-tab="journey" onclick="switchTab('journey')"><span class="tab-num" style="background:rgba(5,150,105,0.15);color:rgba(52,211,153,0.8);">&#10140;</span><span class="tab-label">Future Journey</span></button>
    <button class="tab-btn" data-tab="usecases" onclick="switchTab('usecases')"><span class="tab-num" style="background:rgba(123,47,255,0.15);color:rgba(167,139,250,0.8);">&#9733;</span><span class="tab-label">Use Cases</span></button>
  </div>
  <div class="sidebar-footer">
    <div class="sidebar-footer-text">Prepared by Backbase Value Consulting<br>{{ASSESSMENT_DATE}} | Confidential</div>
  </div>
</nav>

<!-- ═══════ HERO ═══════ -->
<section class="hero">
  <div class="hero-dark">
    <div class="hero-dark-inner">
      <div class="hero-content">
        <div class="hero-overline">Value Consulting Assessment &bull; {{ASSESSMENT_DATE}}</div>
        <h1>{{HERO_H1}}</h1>
        <p class="hero-sub">{{HERO_SUBTITLE}}</p>
        <div class="hero-tags">{{HERO_TAGS}}</div>
        <div class="hero-alert">{{HERO_ALERT}}</div>
      </div>
      <div class="hero-visual">
        <img class="hero-visual-img" src="{{HERO_IMAGE_URL}}" alt="Assessment Visual" loading="eager">
        {{HERO_FLOATS}}
      </div>
    </div>
  </div>
  <div class="hero-stats-strip">
    <div class="hero-stats-inner">{{HERO_STATS}}</div>
  </div>
</section>

<!-- ═══════ PANELS (V5: enforced sub-structures with transformation thread) ═══════ -->
<div class="wrap">

  <!-- ── EXEC SUMMARY ── -->
  <div class="panel active" id="panel-exec">
    <div class="section-header">
      <div class="overline">Backbase Value Consulting &bull; {{ASSESSMENT_DATE}}</div>
      <h2>Executive Summary</h2>
      <p>{{EXEC_SUMMARY_DESC}}</p>
    </div>
    <!-- TRANSFORMATION THREAD: Why we're here -->
    <div class="card" style="margin-bottom:32px;">
      {{EXEC_TRANSFORMATION_STORY}}
    </div>
    <div class="bento">{{EXEC_BENTO_ITEMS}}</div>
    <div class="dark-feature">{{EXEC_PILLARS}}</div>
    <div class="card-grid card-grid-4" style="margin-top:32px;">{{EXEC_METRIC_CARDS}}</div>
    {{EXEC_DECISION_BOX}}
  </div>

  <!-- ── ACT 1: Strategic Alignment ── -->
  <div class="panel" id="panel-act1">
    <div class="section-header">
      <div class="overline">Act 1 of 7</div>
      <h2>{{ACT1_TITLE}}</h2>
      <p>{{ACT1_DESC}}</p>
    </div>
    <!-- TRANSFORMATION THREAD: Why transformation is needed -->
    <div class="card" style="margin-bottom:24px;">{{ACT1_TRANSFORMATION_THREAD}}</div>
    <div class="dark-feature">{{ACT1_DARK_FEATURE}}</div>
    <div class="card-grid card-grid-2" style="margin-top:32px;">{{ACT1_INSIGHT_CARDS}}</div>
    {{ACT1_ADDITIONAL_CONTENT}}
  </div>

  <!-- ── ACT 2: The Vision ── -->
  <div class="panel" id="panel-act2">
    <div class="section-header">
      <div class="overline">Act 2 of 7</div>
      <h2>{{ACT2_TITLE}}</h2>
      <p>{{ACT2_DESC}}</p>
    </div>
    <!-- TRANSFORMATION THREAD: What the transformation looks like -->
    <div class="card" style="margin-bottom:24px;">{{ACT2_TRANSFORMATION_THREAD}}</div>
    <div class="card-grid card-grid-3" style="margin-bottom:32px;">{{ACT2_PILLAR_CARDS}}</div>
    {{ACT2_ADDITIONAL_CONTENT}}
  </div>

  <!-- ── ACT 3: The Lighthouse ── -->
  <div class="panel" id="panel-act3">
    <div class="section-header">
      <div class="overline">Act 3 of 7</div>
      <h2>{{ACT3_TITLE}}</h2>
      <p>{{ACT3_DESC}}</p>
    </div>
    <!-- TRANSFORMATION THREAD: How we prove the transformation -->
    <div class="card" style="margin-bottom:24px;">{{ACT3_TRANSFORMATION_THREAD}}</div>
    <div class="card" style="margin-bottom:32px;">{{ACT3_LIGHTHOUSE_DETAIL}}</div>
    <div class="card-grid card-grid-3">{{ACT3_MILESTONE_CARDS}}</div>
    {{ACT3_ADDITIONAL_CONTENT}}
  </div>

  <!-- ── ACT 4: Deep-Dive Assessment (enforces journey experience map) ── -->
  <div class="panel" id="panel-act4">
    <div class="section-header">
      <div class="overline">Act 4 of 7</div>
      <h2>{{ACT4_TITLE}}</h2>
      <p>{{ACT4_DESC}}</p>
    </div>
    <!-- TRANSFORMATION THREAD: Where current system breaks -->
    <div class="card" style="margin-bottom:24px;">{{ACT4_TRANSFORMATION_THREAD}}</div>
    <!-- Persona cards -->
    <div class="card-grid card-grid-2" style="margin-bottom:32px;">{{ACT4_PERSONAS}}</div>
    <!-- Journey Experience Map (MANDATORY) -->
    <div class="jx">
      <div class="jx-headlines">{{ACT4_JX_HEADLINES}}</div>
      <div class="jx-map">{{ACT4_JX_SVG}}</div>
      {{ACT4_JX_PANELS}}
    </div>
    {{ACT4_ADDITIONAL_CONTENT}}
  </div>

  <!-- ── ACT 5: Capability Assessment (02e lifecycle pipeline architecture) ── -->
  <div class="panel" id="panel-act5">
    <div class="section-header">
      <div class="overline">Act 5 of 7</div>
      <h2>{{ACT5_TITLE}}</h2>
      <p>{{ACT5_DESC}}</p>
    </div>
    <!-- TRANSFORMATION THREAD: What capabilities the transformation requires -->
    <div class="card" style="margin-bottom:24px;">{{ACT5_TRANSFORMATION_THREAD}}</div>

    <!-- Hero Stats Row (02e architecture) -->
    {{ACT5_HERO_STATS}}

    <!-- Dark Feature Banner — structural barrier narrative -->
    {{ACT5_DARK_FEATURE}}

    <!-- Lifecycle Pipeline -->
    <div style="margin-bottom:12px;">
      <div style="font-size:0.62rem;font-weight:800;text-transform:uppercase;letter-spacing:3px;color:var(--muted);margin-bottom:16px;">{{ACT5_PIPELINE_LABEL}}</div>
    </div>
    <div id="lc-pipeline" style="display:grid;grid-template-columns:repeat(5,1fr);gap:0;margin-bottom:0;position:relative;">
      <!-- Pipeline stages rendered by JS -->
    </div>
    <div id="lc-arrow" style="display:none;margin-bottom:0;position:relative;height:20px;">
      <div id="lc-arrow-inner" style="position:absolute;top:0;width:0;height:0;border-left:14px solid transparent;border-right:14px solid transparent;border-top:14px solid var(--bb-blue);transition:left 0.4s cubic-bezier(0.4,0,0.2,1);"></div>
    </div>
    <div id="lc-detail" style="margin-bottom:32px;">
      <!-- Rendered by JS -->
    </div>

    <!-- Toggle Full Grid -->
    <div style="text-align:center;margin-bottom:24px;">
      <button onclick="toggleFullGrid()" id="full-grid-btn" style="padding:12px 28px;border-radius:12px;border:2px solid var(--border);background:var(--card);font-size:0.82rem;font-weight:700;color:var(--text);cursor:pointer;transition:all 0.3s ease;letter-spacing:-0.2px;" onmouseover="this.style.borderColor='var(--accent)';this.style.boxShadow='0 4px 16px rgba(51,102,255,0.1)';" onmouseout="this.style.borderColor='var(--border)';this.style.boxShadow='none';">Show All {{ACT5_CAP_COUNT}} Capabilities</button>
    </div>
    <div id="full-heatmap" style="display:none;margin-top:24px;">
      <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:20px;">{{ACT5_DOMAIN_LEGEND}}</div>
      <div id="hm-container" class="heatmap-grid"></div>
      <div id="hm-detail" class="hm-detail-panel">
        <div id="hm-detail-content"></div>
        <div id="hm-detail-extended"></div>
      </div>
    </div>

    <!-- Capability + Lifecycle Data -->
    <script>
      window['caps_hm-container'] = [{{ACT5_HEATMAP_DATA}}];
      var TNB_CAPS = window['caps_hm-container'];
      var LIFECYCLE_STAGES = [{{ACT5_LIFECYCLE_STAGES}}];
    </script>
  </div>

  <!-- ── ACT 6: Delivery Roadmap (enforces timeline) ── -->
  <div class="panel" id="panel-act6">
    <div class="section-header">
      <div class="overline">Act 6 of 7</div>
      <h2>{{ACT6_TITLE}}</h2>
      <p>{{ACT6_DESC}}</p>
    </div>
    <!-- TRANSFORMATION THREAD: How we build the transformation -->
    <div class="card" style="margin-bottom:24px;">{{ACT6_TRANSFORMATION_THREAD}}</div>
    <!-- Roadmap timeline (MANDATORY) -->
    <div class="timeline">{{ACT6_TIMELINE}}</div>
    <div class="card-grid card-grid-3" style="margin-top:32px;">{{ACT6_PHASE_CARDS}}</div>
    {{ACT6_ADDITIONAL_CONTENT}}
  </div>

  <!-- ── ACT 7: Benefits Case (enforces scenario toggle) ── -->
  <div class="panel" id="panel-act7">
    <div class="section-header">
      <div class="overline">Act 7 of 7</div>
      <h2>{{ACT7_TITLE}}</h2>
      <p>{{ACT7_DESC}}</p>
    </div>
    <!-- TRANSFORMATION THREAD: Why transformation pays for itself -->
    <div class="card" style="margin-bottom:24px;">{{ACT7_TRANSFORMATION_THREAD}}</div>
    <!-- Scenario Toggle (MANDATORY) -->
    <div class="scenario-toggle">
      <button class="scenario-btn" onclick="setScenario('conservative',this)">Conservative</button>
      <button class="scenario-btn active" onclick="setScenario('base',this)">Base</button>
      <button class="scenario-btn" onclick="setScenario('aspirational',this)">Aspirational</button>
    </div>
    <div class="roi-grid">{{ACT7_ROI_CARDS}}</div>
    <div id="scenario-desc" style="margin-top:16px;font-size:0.85rem;color:var(--muted);">{{ACT7_BASE_DESC}}</div>
    <script>
      var scenarios = {{{ACT7_SCENARIO_DATA}}};
    </script>
    {{ACT7_FINANCIAL_TABLE}}
    {{ACT7_VALUE_LEVERS}}
  </div>

  <!-- ── FUTURE JOURNEY (enforces swimlanes) ── -->
  <div class="panel" id="panel-journey">
    <div class="section-header">
      <div class="overline">Future Journey</div>
      <h2>Future State Journey Maps</h2>
      <p>{{JOURNEY_DESC}}</p>
    </div>
    {{JOURNEY_SWIMLANES}}
  </div>

  <!-- ── USE CASES (enforces phone prototypes) ── -->
  <div class="panel" id="panel-usecases">
    <div class="section-header">
      <div class="overline">Signature Use Cases</div>
      <h2>{{USECASES_TITLE}}</h2>
      <p>{{USECASES_DESC}}</p>
    </div>
    <div class="uc-grid">{{USECASES_CARDS}}</div>
    {{USECASES_PHONE_PROTOTYPES}}
  </div>

</div>

<script>
/* ── TAB SWITCHING ── */
function switchTab(id) {
  document.querySelectorAll('.tab-btn').forEach(function(b){ b.classList.remove('active'); });
  document.querySelectorAll('.panel').forEach(function(p){ p.classList.remove('active'); });
  document.querySelector('[data-tab="'+id+'"]').classList.add('active');
  var panel = document.getElementById('panel-'+id);
  panel.classList.add('active');
  document.querySelectorAll('.section-divider').forEach(function(d){ d.style.display = 'none'; });
  window.scrollTo({top: 0, behavior:'smooth'});
  setTimeout(function(){
    panel.querySelectorAll('.reveal').forEach(function(el){ el.classList.remove('visible'); });
    setTimeout(function(){
      panel.querySelectorAll('.reveal').forEach(function(el){
        var rect = el.getBoundingClientRect();
        if(rect.top < window.innerHeight) el.classList.add('visible');
      });
    }, 100);
  }, 50);
}

/* ── EXPANDABLE SECTIONS ── */
document.addEventListener('click', function(e) {
  var header = e.target.closest('.expand-header');
  if (header) { header.closest('.expandable').classList.toggle('open'); }
  var persona = e.target.closest('.persona-card');
  if (persona && !e.target.closest('a')) { persona.classList.toggle('open'); }
  var phaseCard = e.target.closest('.phase-card');
  if (phaseCard) { phaseCard.classList.toggle('open'); }
  var ucCard = e.target.closest('.uc-card');
  if (ucCard && !e.target.closest('a')) { ucCard.classList.toggle('open'); }
  /* lever-card toggle handled by inline onclick on .lever-header */
});

/* ── SCROLL REVEAL (IntersectionObserver) ── */
(function initReveal(){
  var els = document.querySelectorAll('.reveal, .card, .metric-card, .persona-card, .pillar-card, .expandable, .hm-cell, .uc-card, .uc-stat-card, .proto-wrap');
  if(!('IntersectionObserver' in window)){ els.forEach(function(e){e.classList.add('visible');}); return; }
  var io = new IntersectionObserver(function(entries){
    entries.forEach(function(entry){
      if(entry.isIntersecting){
        entry.target.classList.add('visible');
        entry.target.style.opacity='1';
        entry.target.style.transform='translateY(0)';
      }
    });
  }, {threshold: 0.05, rootMargin: '0px 0px -30px 0px'});
  els.forEach(function(el){
    if(!el.closest('.hero')){ el.style.opacity='0'; el.style.transform='translateY(30px)'; el.style.transition='opacity 0.7s cubic-bezier(0.16,1,0.3,1), transform 0.7s cubic-bezier(0.16,1,0.3,1)'; io.observe(el); }
  });
})();

/* ── CAPABILITY HEATMAP ENGINE ── */
var scoreColors = ['#DC2626','#EA580C','#0891B2','#059669','#2563EB'];
var scoreLabels = ['L0: Non-Existent','L1: Ad-Hoc','L2: Developing','L3: Defined','L4: Optimized'];

function renderHeatmap(containerId, caps) {
  var container = document.getElementById(containerId);
  if (!container || !caps) return;
  var html = '';
  caps.forEach(function(c, i) {
    html += '<div class="hm-cell" data-idx="'+i+'" onclick="selectCell(this,\''+containerId+'\','+i+')">';
    html += '<div class="hm-score" style="background:'+scoreColors[c.score]+';">'+c.score+'</div>';
    html += '<div class="hm-id">'+c.id+'</div>';
    html += '<div class="hm-name">'+c.name+'</div>';
    html += '<div style="font-size:0.6rem;color:var(--muted);margin-top:4px;">'+c.domain+'</div>';
    html += '</div>';
  });
  container.innerHTML = html;
}

function selectCell(el, src, idx) {
  document.querySelectorAll('.hm-cell').forEach(function(c){ c.classList.remove('selected'); });
  el.classList.add('selected');
  var allCaps = window['caps_'+src] || [];
  var cap = allCaps[idx];
  if (!cap) return;
  var panel = document.getElementById('hm-detail');
  var content = document.getElementById('hm-detail-content');
  var extended = document.getElementById('hm-detail-extended');
  /* Header: score badge + name + value impact */
  content.innerHTML = '<div style="display:flex;align-items:center;gap:14px;margin-bottom:16px;flex-wrap:wrap;">'+
    '<div class="score-badge s'+cap.score+'" style="width:44px;height:44px;font-size:1rem;">'+cap.score+'</div>'+
    '<div><div style="font-size:1.1rem;font-weight:800;letter-spacing:-0.3px;">'+cap.id+': '+cap.name+'</div>'+
    '<div style="font-size:0.78rem;color:var(--muted);margin-top:2px;">Domain: '+cap.domain+' &bull; '+scoreLabels[cap.score]+'</div></div>'+
    (cap.impact ? '<div style="margin-left:auto;text-align:right;"><div style="font-size:0.65rem;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);margin-bottom:2px;">Value Impact</div><div style="font-size:0.88rem;font-weight:800;color:#DC2626;">'+cap.impact+'</div></div>' : '')+
    '</div>'+
    '<div style="margin-bottom:14px;"><div class="score-bar" style="width:100%;"><div class="score-bar-fill" style="width:'+(cap.score/4*100)+'%;background:'+scoreColors[cap.score]+';"></div></div></div>';
  /* Extended: assessment detail + F/M/B breakdown */
  var ext = '';
  if (cap.desc) {
    ext += '<div style="background:#F8FAFC;border-radius:12px;padding:16px;margin-bottom:14px;border:1px solid var(--border);"><div style="font-size:0.65rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin-bottom:8px;">Assessment Detail</div><p style="font-size:0.84rem;color:var(--text);line-height:1.8;">'+cap.desc+'</p></div>';
  }
  if (typeof cap.front !== 'undefined') {
    ext += '<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;">';
    var fmb = [{lbl:'Front Office',val:cap.front},{lbl:'Middle Office',val:cap.middle},{lbl:'Back Office',val:cap.back}];
    fmb.forEach(function(item){
      var c = scoreColors[item.val] || '#94A3B8';
      ext += '<div style="background:#F8FAFC;border-radius:10px;padding:12px;text-align:center;"><div style="font-size:0.65rem;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);margin-bottom:6px;">'+item.lbl+'</div><div style="font-size:1.4rem;font-weight:800;color:'+c+';">'+item.val+'</div></div>';
    });
    ext += '</div>';
  }
  extended.innerHTML = ext;
  panel.classList.add('visible');
  panel.scrollIntoView({behavior:'smooth', block:'nearest'});
}

/* ── LIFECYCLE PIPELINE ENGINE (02e architecture) ── */
var lcState = { stage: null, l1: null };

function hexToRgb(hex) {
  var r = parseInt(hex.slice(1,3),16);
  var g = parseInt(hex.slice(3,5),16);
  var b = parseInt(hex.slice(5,7),16);
  return r+','+g+','+b;
}

function adjustColor(hex, amount) {
  var r = Math.min(255, Math.max(0, parseInt(hex.slice(1,3),16) + amount));
  var g = Math.min(255, Math.max(0, parseInt(hex.slice(3,5),16) + amount));
  var b = Math.min(255, Math.max(0, parseInt(hex.slice(5,7),16) + amount));
  return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
}

function selectStage(idx) {
  if (lcState.stage === idx) { lcState.stage = null; lcState.l1 = null; }
  else { lcState.stage = idx; lcState.l1 = null; }
  renderLifecycleTree();
}

function toggleL1(stageIdx, l1Idx) {
  if (lcState.l1 === l1Idx) { lcState.l1 = null; }
  else { lcState.l1 = l1Idx; }
  renderLifecycleTree();
}

function renderCapCards(caps, stageColor) {
  var matColors = scoreColors;
  var matLabels = ['Non-Existent','Ad-Hoc','Developing','Defined','Optimized'];
  var allCaps = (typeof TNB_CAPS !== 'undefined') ? TNB_CAPS : (window['caps_hm-container'] || []);
  var html = '';
  caps.forEach(function(capId) {
    var cap = allCaps.filter(function(c){ return c.id === capId; })[0];
    if (!cap) return;
    var mc = matColors[cap.score];
    var ml = matLabels[cap.score];
    html += '<div class="lc-cap-card" style="--cap-color:'+mc+';">';
    html += '<div style="position:absolute;top:0;left:0;right:0;height:3px;background:'+mc+';"></div>';
    html += '<div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">';
    html += '<div style="width:42px;height:42px;border-radius:12px;background:'+mc+';display:flex;align-items:center;justify-content:center;color:#fff;font-weight:900;font-size:1.05rem;box-shadow:0 2px 8px rgba(0,0,0,0.15);flex-shrink:0;">'+cap.score+'</div>';
    html += '<div><div style="font-size:0.6rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;">'+cap.id+'</div>';
    html += '<div style="font-size:0.85rem;font-weight:800;color:var(--text);letter-spacing:-0.2px;">'+cap.name+'</div></div></div>';
    html += '<div style="display:flex;flex-wrap:wrap;align-items:center;gap:6px;margin-bottom:10px;">';
    html += '<span style="font-size:0.6rem;font-weight:700;padding:3px 10px;border-radius:6px;background:rgba('+hexToRgb(mc)+',0.08);color:'+mc+';">'+ml+'</span>';
    html += '<span style="font-size:0.6rem;font-weight:700;padding:3px 10px;border-radius:6px;background:rgba(0,0,0,0.03);color:var(--muted);">'+cap.domain+'</span>';
    if (cap.impact) {
      html += '<span style="font-size:0.6rem;font-weight:700;padding:3px 10px;border-radius:6px;background:rgba(220,38,38,0.06);color:#DC2626;">'+cap.impact+'</span>';
    }
    html += '</div>';
    html += '<p style="font-size:0.76rem;color:var(--muted);line-height:1.6;margin-bottom:6px;"><strong>Evidence:</strong> '+cap.desc.substring(0,200)+(cap.desc.length>200?'...':'')+'</p>';
    if (typeof cap.front !== 'undefined') {
      html += '<div style="display:flex;gap:8px;margin-top:8px;">';
      [{l:'F',v:cap.front},{l:'M',v:cap.middle},{l:'B',v:cap.back}].forEach(function(x){
        html += '<span style="font-size:0.58rem;font-weight:700;padding:2px 8px;border-radius:4px;background:'+matColors[x.v]+';color:#fff;">'+x.l+':'+x.v+'</span>';
      });
      html += '</div>';
    }
    html += '</div>';
  });
  return html;
}

function renderLifecycleTree() {
  var pipeline = document.getElementById('lc-pipeline');
  var arrow = document.getElementById('lc-arrow');
  var detail = document.getElementById('lc-detail');
  if (!pipeline || !arrow || !detail || typeof LIFECYCLE_STAGES === 'undefined' || !LIFECYCLE_STAGES.length) return;

  var pH = '';
  LIFECYCLE_STAGES.forEach(function(s, i) {
    var isActive = lcState.stage === i;
    pH += '<div class="lc-stage'+(isActive ? ' active' : '')+'" style="--stage-color:'+s.color+';" onclick="selectStage('+i+')">';
    pH += '<div class="lc-num">'+(i+1)+'</div>';
    pH += '<div class="lc-icon">'+s.icon+'</div>';
    pH += '<div class="lc-title">'+s.title+'</div>';
    pH += '<div class="lc-sub">'+s.tagline+'</div>';
    pH += '<div class="lc-stat">'+s.stat+' '+s.statLabel+'</div>';
    pH += '</div>';
  });
  pipeline.innerHTML = pH;

  if (lcState.stage !== null) {
    arrow.style.display = 'block';
    var stageWidth = 100 / LIFECYCLE_STAGES.length;
    var leftPct = (lcState.stage * stageWidth) + (stageWidth / 2);
    var arrowEl = document.getElementById('lc-arrow-inner');
    arrowEl.style.left = 'calc('+leftPct+'% - 14px)';
    arrowEl.style.borderTopColor = LIFECYCLE_STAGES[lcState.stage].color;
  } else {
    arrow.style.display = 'none';
  }

  if (lcState.stage === null) {
    detail.innerHTML = '<div style="text-align:center;padding:48px 20px;color:var(--muted);font-size:0.88rem;">' +
      '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin:0 auto 12px;display:block;opacity:0.3;"><path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>' +
      'Select a lifecycle stage above to explore capability gaps</div>';
    return;
  }

  var stage = LIFECYCLE_STAGES[lcState.stage];
  var sc = stage.color;
  var scRgb = hexToRgb(sc);
  var dH = '<div class="lc-detail-section">';
  dH += '<div style="background:linear-gradient(135deg, '+sc+' 0%, '+adjustColor(sc, 30)+' 100%);border-radius:20px;padding:32px 36px;margin-bottom:24px;position:relative;overflow:hidden;">';
  dH += '<div style="position:absolute;top:-40px;right:-20px;width:200px;height:200px;background:radial-gradient(circle,rgba(255,255,255,0.1) 0%,transparent 70%);pointer-events:none;"></div>';
  dH += '<div style="display:flex;align-items:center;gap:16px;margin-bottom:12px;">';
  dH += '<div style="font-size:2.2rem;filter:drop-shadow(0 2px 8px rgba(0,0,0,0.2));">'+stage.icon+'</div>';
  dH += '<div><div style="font-size:0.58rem;font-weight:700;text-transform:uppercase;letter-spacing:2.5px;color:rgba(255,255,255,0.6);">Stage '+(lcState.stage+1)+'</div>';
  dH += '<div style="font-size:1.6rem;font-weight:900;color:#fff;letter-spacing:-0.5px;">'+stage.title+'</div></div>';
  dH += '<div style="margin-left:auto;text-align:right;"><div style="font-size:2rem;font-weight:900;color:#fff;line-height:1;">'+stage.stat+'</div>';
  dH += '<div style="font-size:0.68rem;color:rgba(255,255,255,0.65);font-weight:600;">'+stage.statLabel+'</div></div></div>';
  dH += '<p style="font-size:0.88rem;color:rgba(255,255,255,0.75);line-height:1.7;max-width:640px;">'+stage.statDetail+'</p></div>';

  dH += '<div style="display:flex;flex-direction:column;gap:16px;">';
  stage.l1s.forEach(function(l1, l1i) {
    var isExp = lcState.l1 === l1i;
    var totalCaps = 0;
    l1.l2s.forEach(function(l2){ totalCaps += l2.caps.length; });
    dH += '<div>';
    dH += '<div class="lc-l1-card'+(isExp?' expanded':'')+'" style="--stage-color:'+sc+';" onclick="toggleL1('+lcState.stage+','+l1i+')">';
    dH += '<div style="display:flex;align-items:center;gap:14px;">';
    dH += '<div style="width:40px;height:40px;border-radius:12px;background:rgba('+scRgb+',0.08);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all 0.3s ease;'+(isExp?'background:'+sc+';':'') +'">';
    dH += '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="'+(isExp?'#fff':sc)+'" stroke-width="2" style="transition:all 0.3s ease;transform:rotate('+(isExp?'90':'0')+'deg);"><path d="M9 18l6-6-6-6"/></svg></div>';
    dH += '<div style="flex:1;"><div style="font-size:1rem;font-weight:800;color:var(--text);letter-spacing:-0.3px;margin-bottom:3px;">'+l1.label+'</div>';
    dH += '<div style="font-size:0.78rem;color:var(--muted);line-height:1.5;">'+l1.desc+'</div></div>';
    dH += '<div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px;flex-shrink:0;">';
    dH += '<span style="font-size:0.6rem;font-weight:700;padding:4px 12px;border-radius:8px;background:rgba('+scRgb+',0.08);color:'+sc+';">'+totalCaps+' capabilities</span>';
    dH += '<span style="font-size:0.6rem;font-weight:700;padding:4px 12px;border-radius:8px;background:rgba(0,0,0,0.03);color:var(--muted);">'+l1.l2s.length+' finding'+(l1.l2s.length>1?'s':'')+'</span>';
    dH += '</div></div></div>';
    dH += '<div class="lc-l2-zone'+(isExp?' open':'')+'">';
    if (isExp) {
      l1.l2s.forEach(function(l2) {
        dH += '<div style="background:rgba('+scRgb+',0.02);border:1px solid rgba('+scRgb+',0.1);border-radius:14px;padding:20px 22px;margin-bottom:16px;">';
        dH += '<div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">';
        dH += '<div style="width:6px;height:6px;border-radius:50%;background:'+sc+';flex-shrink:0;"></div>';
        dH += '<div style="font-size:0.92rem;font-weight:800;color:var(--text);letter-spacing:-0.2px;">'+l2.label+'</div></div>';
        dH += '<p style="font-size:0.8rem;color:var(--muted);line-height:1.65;margin-bottom:16px;padding-left:16px;">'+l2.desc+'</p>';
        dH += '<div style="padding-left:16px;"><div style="font-size:0.6rem;font-weight:800;text-transform:uppercase;letter-spacing:2px;color:var(--muted);margin-bottom:12px;">Capability Gaps ('+l2.caps.length+')</div>';
        dH += '<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;">';
        dH += renderCapCards(l2.caps, sc);
        dH += '</div></div></div>';
      });
    }
    dH += '</div></div>';
  });
  dH += '</div></div>';
  detail.innerHTML = dH;
}

function toggleFullGrid() {
  var el = document.getElementById('full-heatmap');
  var btn = document.getElementById('full-grid-btn');
  var allCaps = (typeof TNB_CAPS !== 'undefined') ? TNB_CAPS : (window['caps_hm-container'] || []);
  if (el.style.display === 'none') {
    el.style.display = 'block';
    btn.textContent = 'Hide Full Grid';
    renderHeatmap('hm-container', allCaps);
  } else {
    el.style.display = 'none';
    btn.textContent = 'Show All ' + allCaps.length + ' Capabilities';
  }
}

/* Initialize lifecycle tree if data exists */
if (typeof LIFECYCLE_STAGES !== 'undefined' && LIFECYCLE_STAGES.length) { renderLifecycleTree(); }

/* ── TRACEABILITY ENGINE ── */
document.addEventListener('mouseover', function(e) {
  var traced = e.target.closest('[data-trace-id]');
  if (traced) {
    var traceId = traced.getAttribute('data-trace-id');
    document.querySelectorAll('[data-trace-id="'+traceId+'"]').forEach(function(el){
      el.classList.add('trace-highlight');
    });
  }
});
document.addEventListener('mouseout', function(e) {
  var traced = e.target.closest('[data-trace-id]');
  if (traced) {
    document.querySelectorAll('.trace-highlight').forEach(function(el){
      el.classList.remove('trace-highlight');
    });
  }
});

/* ── JOURNEY EXPERIENCE MAP (Stage Selection) ── */
function showStage(n) {
  document.querySelectorAll('.jx-marker').forEach(function(m){ m.classList.remove('active'); });
  document.querySelectorAll('.jx-panel').forEach(function(p){ p.classList.remove('active'); });
  var marker = document.querySelector('.jx-marker[data-stage="'+n+'"]');
  var panel = document.getElementById('jxp-'+n);
  if(marker) marker.classList.add('active');
  if(panel){
    panel.classList.add('active');
    setTimeout(function(){ panel.scrollIntoView({behavior:'smooth', block:'nearest'}); }, 120);
  }
}

/* ── JOURNEY SWIMLANE TOGGLE (Before/After) ── */
function toggleJourney(journeyId, state, btn) {
  var container = document.getElementById('journey-' + journeyId);
  if (!container) return;
  container.querySelectorAll('.swimlane-panel').forEach(function(p) { p.classList.remove('active'); });
  container.querySelector('.swimlane-panel[data-state="' + state + '"]').classList.add('active');
  container.querySelectorAll('.swimlane-toggle-btn').forEach(function(b) {
    b.classList.remove('active-current', 'active-future');
  });
  btn.classList.add(state === 'current' ? 'active-current' : 'active-future');
}

/* ── ROI SCENARIO TOGGLE ── */
function setScenario(key, btn) {
  document.querySelectorAll('.scenario-btn').forEach(function(b){ b.classList.remove('active'); });
  btn.classList.add('active');
  var s = scenarios[key];
  if (!s) return;
  var npvEl = document.getElementById('roi-npv');
  var roiEl = document.getElementById('roi-return');
  var payEl = document.getElementById('roi-payback');
  var benEl = document.getElementById('roi-benefits');
  var descEl = document.getElementById('scenario-desc');
  if (npvEl) { npvEl.textContent = s.npv; npvEl.style.color = s.npv.indexOf('-') === 0 ? '#DC2626' : '#059669'; }
  if (roiEl) { roiEl.textContent = s.roi; roiEl.style.color = s.roi.indexOf('-') === 0 ? '#DC2626' : '#059669'; }
  if (payEl) payEl.textContent = s.payback;
  if (benEl) benEl.textContent = s.benefits;
  if (descEl) descEl.textContent = s.desc;
}

/* ── INITIATIVE CARD TOGGLE ── */
document.addEventListener('click', function(e) {
  var init = e.target.closest('.initiative-card');
  if (init) { init.classList.toggle('open'); }
});

/* ── FLOATING BACKGROUND PARTICLES ── */
(function initParticles(){
  var colors = ['rgba(51,102,255,0.08)','rgba(123,47,255,0.06)','rgba(5,150,105,0.05)'];
  for(var i=0;i<6;i++){
    var p = document.createElement('div');
    p.className = 'bg-particle';
    p.style.width = (6+Math.random()*12)+'px';
    p.style.height = p.style.width;
    p.style.left = (10+Math.random()*80)+'%';
    p.style.top = (10+Math.random()*80)+'%';
    p.style.background = colors[i%3];
    p.style.animationDelay = (Math.random()*10)+'s';
    p.style.animationDuration = (15+Math.random()*15)+'s';
    document.body.appendChild(p);
  }
})();

/* ── AUTO-INIT: render heatmaps from partial data (data may be in earlier <script> blocks) ── */
/* Auto-init removed — heatmap grid now behind toggle button; lifecycle pipeline is primary view */
</script>
</body>
</html>
